<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <template id="manifest_json" name="PWA Manifest Assets">
            <link id="xpanel_manifest" rel="manifest" href="/xpanel_erp/static/manifest.json?v=1.0.2"/>
            <link id="xpanel_icon" rel="icon" type="image/png" href="/xpanel_erp/static/src/img/xpanelerp.png?v=1.0.2"/>
            <link id="xpanel_shortcut_icon" rel="shortcut icon" type="image/png" href="/xpanel_erp/static/src/img/xpanelerp.png?v=1.0.2"/>
            <link id="xpanel_apple_icon" rel="apple-touch-icon" href="/xpanel_erp/static/src/img/xpanelerp.png?v=1.0.2"/>
            
            <meta name="apple-mobile-web-app-capable" content="yes"/>
            <meta name="mobile-web-app-capable" content="yes"/>
            <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
            <meta name="apple-mobile-web-app-title" content="XpanelERP"/>
            <meta name="application-name" content="XpanelERP"/>
            <meta name="theme-color" content="#000000"/>

            <script type="text/javascript">
                <![CDATA[
                (function() {
                    function cleanOdooBranding() {
                        document.querySelectorAll('link[rel="manifest"]').forEach(l => {
                            if (l.id !== 'xpanel_manifest') l.remove();
                        });

                        document.querySelectorAll('link[rel*="icon"], link[rel="apple-touch-icon"]').forEach(i => {
                            if (!i.id.startsWith('xpanel_')) {
                                i.remove();
                            }
                        });

                        if (document.title.toLowerCase().includes('odoo')) {
                            document.title = document.title.replace(/Odoo/gi, 'XpanelERP');
                        } else if (!document.title.includes('XpanelERP')) {
                            document.title = 'XpanelERP | ' + document.title;
                        }

                        ['apple-mobile-web-app-title', 'application-name'].forEach(name => {
                            let meta = document.querySelector('meta[name="' + name + '"]');
                            if (!meta) {
                                meta = document.createElement('meta');
                                meta.name = name;
                                document.head.appendChild(meta);
                            }
                            if (meta.getAttribute('content') !== 'XpanelERP') {
                                meta.setAttribute('content', 'XpanelERP');
                            }
                        });

                        const theme = document.querySelector('meta[name="theme-color"]');
                        if (theme && theme.getAttribute('content') !== '#000000') {
                            theme.setAttribute('content', '#000000');
                        }

                        const websiteFavicon = document.querySelector('link[href*="favicon.ico"]');
                        if (websiteFavicon && !websiteFavicon.id.startsWith('xpanel_')) {
                            websiteFavicon.remove();
                        }
                    }

                    cleanOdooBranding();

                    const observer = new MutationObserver(cleanOdooBranding);
                    observer.observe(document.head, { childList: true, subtree: true });

                    window.addEventListener('load', cleanOdooBranding);
                    window.addEventListener('DOMContentLoaded', cleanOdooBranding);
                })();
                ]]>
            </script>
        </template>

        <template id="service_worker_registration" name="PWA Service Worker">
            <script type="text/javascript">
                <![CDATA[
                if ('serviceWorker' in navigator) {
                    window.addEventListener('load', function() {
                        navigator.serviceWorker.getRegistrations().then(function(registrations) {
                            for(let registration of registrations) {
                                if (!registration.active || !registration.active.scriptURL.includes('xpanel_erp')) {
                                    registration.unregister();
                                }
                            }
                        });
                        navigator.serviceWorker.register('/xpanel_erp/static/sw.js?v=1.0.3')
                            .then(reg => console.log('XpanelERP: SW registered'))
                            .catch(err => console.log('XpanelERP: SW failed', err));
                    });
                }
                ]]>
            </script>
        </template>

        <template id="layout_inherit_pwa" inherit_id="web.layout">
            <xpath expr="//head/*[1]" position="before">
                <t t-call="xpanel_erp.manifest_json"/>
                <t t-call="xpanel_erp.service_worker_registration"/>
            </xpath>
        </template>

        <template id="xpanel_footer_template" name="XpanelERP Footer Navigation">
            <div id="xpanel_footer" class="xpanel-footer">
                <div class="xpanel-footer-container">
                    <button class="xpanel-footer-btn" data-action="home">
                        <svg class="xpanel-footer-icon" viewBox="0 0 24 24" fill="currentColor">
                            <rect x="2" y="2" width="5" height="5" rx="1"></rect>
                            <rect x="9.5" y="2" width="5" height="5" rx="1"></rect>
                            <rect x="17" y="2" width="5" height="5" rx="1"></rect>
                            <rect x="2" y="9.5" width="5" height="5" rx="1"></rect>
                            <rect x="9.5" y="9.5" width="5" height="5" rx="1"></rect>
                            <rect x="17" y="9.5" width="5" height="5" rx="1"></rect>
                            <rect x="2" y="17" width="5" height="5" rx="1"></rect>
                            <rect x="9.5" y="17" width="5" height="5" rx="1"></rect>
                            <rect x="17" y="17" width="5" height="5" rx="1"></rect>
                        </svg>
                        <span class="xpanel-footer-label">Grid</span>
                    </button>
                    
                    <button class="xpanel-footer-btn" data-action="timesheet">
                        <svg class="xpanel-footer-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                        <span class="xpanel-footer-label">Timesheet</span>
                    </button>
                    
                    <button class="xpanel-footer-btn" data-action="ai">
                        <svg class="xpanel-footer-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="11" width="18" height="10" rx="2"></rect>
                            <circle cx="12" cy="5" r="2"></circle>
                            <path d="M12 7v4"></path>
                            <circle cx="8" cy="16" r="0.8"></circle>
                            <circle cx="16" cy="16" r="0.8"></circle>
                        </svg>
                        <span class="xpanel-footer-label">AI</span>
                    </button>
                    
                    <button class="xpanel-footer-btn" data-action="analytics">
                        <svg class="xpanel-footer-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="20" x2="18" y2="10"></line>
                            <line x1="12" y1="20" x2="12" y2="4"></line>
                            <line x1="6" y1="20" x2="6" y2="14"></line>
                        </svg>
                        <span class="xpanel-footer-label">Analytics</span>
                    </button>
                    
                    <button class="xpanel-footer-btn" data-action="back">
                        <svg class="xpanel-footer-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="19" y1="12" x2="5" y2="12"></line>
                            <polyline points="12 19 5 12 12 5"></polyline>
                        </svg>
                        <span class="xpanel-footer-label">Back</span>
                    </button>
                </div>
            </div>
        </template>

        <template id="website_layout_inherit_pwa" inherit_id="website.layout">
            <xpath expr="//head/*[1]" position="before">
                <t t-call="xpanel_erp.manifest_json"/>
                <t t-call="xpanel_erp.service_worker_registration"/>
            </xpath>
            <xpath expr="//body" position="inside">
                <t t-call="xpanel_erp.xpanel_footer_template"/>
            </xpath>
        </template>

        <template id="webclient_bootstrap_inherit" inherit_id="web.webclient_bootstrap">
            <xpath expr="." position="inside">
                <t t-call="xpanel_erp.xpanel_footer_template"/>
            </xpath>
        </template>
    </data>
</odoo>
